#!/bin/bash
: ${SCRIPTS=$(readlink -f $(dirname $0))}
bash $SCRIPTS/common-startup.sh
set -eux
export JUJU_HOME=$HOME/cloud-city
: ${JUJU_REPOSITORY=$HOME/repository}
export JUJU_REPOSITORY
juju_path=$(readlink -f $(dirname $(find extracted-bin -name juju)))
cmd="$SCRIPTS/deploy_job.py --new-juju-bin $juju_path $ENV $WORKSPACE $JOB_NAME"
if [ "${UPGRADE-}" == "true" ]; then
  cmd="$cmd --upgrade"
fi
if [ "${DEBUG-}" == "true" ]; then
  cmd="$cmd --debug"
fi
if [ "${SERIES-}" != "" ]; then
  cmd="$cmd --series $SERIES"
fi
unset ENV CHARM_PREFIX WORKSPACE UPGRADE SERIES
$cmd
